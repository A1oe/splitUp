<!--
SplitUp Web Application - Results Display Page
This page shows the results after processing a CSV file of transactions
Displays original transactions, simplified payments, and individual balances
Uses Flask/Jinja2 templating to display dynamic data from the Python backend
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitUp Results</title>
    <!-- Embedded CSS for results page styling -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Theme toggle button -->
    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
        🌞 Light Mode
    </button>

    <div class="container">
        <!-- Main page title -->
        <h1>Transaction Results</h1>


         <!-- Section showing simplified payment requirements -->
        {% if transactions %}
            <h2>Required Payments</h2>
            <!-- Loop through transactions list (simplified payments) -->
            {% for transaction in transactions %}
                <div class="transaction">
                    <!-- Display format: "Debtor must pay $Amount to Creditor" -->
                    <strong>{{ transaction.debtor }}</strong> must pay <strong>${{ "%.2f"|format(transaction.amount) }}</strong> to <strong>{{ transaction.creditor }}</strong>
                </div>
            {% endfor %}
        {% else %}
            <!-- Special case when no payments are needed (all debts balanced) -->
            <div class="no-transactions">
                <h3>🎉 No transactions necessary!</h3>
                <p>Everyone has paid an equal amount for each other. All debts are already balanced!</p>
            </div>
        {% endif %}

        <!-- Collapsible Summary Statistics -->
        <div class="collapsible-header" onclick="toggleCollapse('summary-content', this)">
            <h3 style="margin: 0;">Summary Statistics</h3>
            <span class="collapse-arrow">▶</span>
        </div>
        <div id="summary-content" class="collapsible-content">
            <div class="stats">
                <!-- Data passed from Flask route: original_transactions, simplified_transactions, reduction -->
                <p><strong>Number of Original transactions:</strong> {{ original_transactions }}</p>
                <p><strong>Number of Simplified transactions:</strong> {{ simplified_transactions }}</p>
                <p><strong>Reduction:</strong> {{ reduction }}%</p>
            </div>

            <!-- Visual Debt Network within Summary -->
            <div style="margin-top: 20px;">
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">🕸️ Original Debt Network</h4>
                <div class="debt-network-container">
                    <svg id="debtNetworkSvg" viewBox="0 0 800 600"></svg>
                    <div class="network-legend">
                        <strong>Legend:</strong>
                        🔵 Person &nbsp;&nbsp; ➡️ Debt Flow &nbsp;&nbsp; 💰 Amount Owed
                        <br><small>This shows whom owes whom money before simplification</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Collapsible Original Transactions Section -->
        {% if original_transactions_list %}
            <div class="collapsible-header" onclick="toggleCollapse('original-transactions-content', this)">
                <h3 style="margin: 0;">Original Transactions</h3>
                <span class="collapse-arrow">▶</span>
            </div>
            <div id="original-transactions-content" class="collapsible-content">
                <div class="original-transactions-list">
                    <!-- Loop through original_transactions_list passed from Flask -->
                    {% for transaction in original_transactions_list %}
                        <div class="original-transaction-item">
                            <!-- Display format: "Payer paid $Amount for Debtor" -->
                            <strong>{{ transaction.creditor }}</strong> paid <strong>${{ "%.2f"|format(transaction.amount) }}</strong> for <strong>{{ transaction.debtor }}</strong>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        <!-- Navigation and Export buttons -->
        <div style="display: flex; gap: 10px; align-items: center; margin-top: 20px; flex-wrap: wrap;">
            <a href="/" class="back-button">← Upload Another File</a>
            <button class="back-button" onclick="exportTransactionsCSV()" style="background-color: var(--accent-green);">
                📊 Export Combined Transactions CSV
            </button>
        </div>
    </div>

    <!-- Hidden data for JavaScript -->
    <script type="application/json" id="transaction-data">{{ original_transactions_list | tojson }}</script>

    <!-- JavaScript for collapsible functionality and theme management -->
    <script src="{{ url_for('static', filename='js/shared.js') }}"></script>
    <script src="{{ url_for('static', filename='js/results.js') }}"></script>
</body>
</html>