<!--
SplitUp Web Application - Main Upload Page
This is the home page where users upload CSV files containing transaction data
The page includes a file upload form and instructions for the expected CSV format
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitUp - Debt Simplifier</title>
    <!-- Embedded CSS for styling the upload interface -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Theme toggle button -->
    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
        üåû Light Mode
    </button>

    <div class="container">
        <!-- Main page title -->
        <h1>SplitUp - Debt Simplifier</h1>
        <p><i>SplitUp will show you the minimum number of payments needed to settle all debts.</i></p>

        <!-- CSV Upload and Format Guide Section -->
        <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
            <!-- CSV Format Guide (Left) -->
            <div class="info" style="flex: 1; min-width: 300px;">
                <h3>CSV Format</h3>
                <p>Your CSV file should have the following format (one transaction per line):</p>
                <!-- Shows the expected CSV format pattern -->
                <code>payer,debtor,amount</code>
                <p><strong>Example:</strong></p>
                <!-- Example transactions showing real data format -->
                <code>Alice,Bob,25.50<br>
                Bob,Charlie,15.00<br>
                Charlie,Alice,30.75</code>
            </div>

            <!-- CSV Upload Section (Right) -->
            <div class="upload-section" style="flex: 1; min-width: 300px;">
                <h3>üìÇ Upload CSV Files (Optional)</h3>
                <p>Upload one or more CSV files to load existing transactions</p>
                <input type="file" id="csvInput" accept=".csv" multiple onchange="loadCSV()">
                <div class="error-message" id="csvErrorMessage"></div>

                <!-- Uploaded Files List -->
                <div id="uploadedFilesList" style="margin-top: 15px; display: none;">
                    <h4 style="margin-bottom: 10px; color: var(--text-primary);">Uploaded Files:</h4>
                    <div id="filesContainer"></div>
                </div>
            </div>
        </div>

        <!-- Main Content Layout: Left Controls, Right Transactions -->
        <div style="display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap;">
            <!-- Left Side: Manual Input and Process Button -->
            <div style="flex: 1; min-width: 400px;">
                <!-- Manual Input Section -->
                <div class="manual-section">
                    <h3>üìù Add Transactions</h3>
                    <div class="error-message" id="errorMessage"></div>

                    <!-- Payer and Amount -->
                    <div class="form-group">
                        <div class="input-container">
                            <input type="text" id="payerInput" placeholder="Who paid?" autocomplete="off">
                            <div id="payerSuggestions" class="autocomplete-suggestions"></div>
                        </div>
                        <span>paid $</span>
                        <input type="number" id="amountInput" placeholder="0.00" step="0.01" min="0" onchange="updateDebtorAmounts()">
                        <span>split among:</span>
                    </div>
                    
                    <!-- Dynamic Debtor List -->
                    <div id="debtorsList">
                        <div class="debtor-entry" data-index="0">
                            <div class="form-group" style="margin-bottom: 8px;">
                                <div class="input-container" style="flex: 2;">
                                    <input type="text" class="debtor-name" placeholder="Who received?" autocomplete="off">
                                </div>
                                <span style="min-width: 40px;">gets</span>
                                <input type="number" class="debtor-percentage" placeholder="%" step="0.1" min="0" max="100" style="width: 70px;" onchange="updateDebtorAmounts()" value="100">
                                <span style="min-width: 15px;">%</span>
                                <span class="debtor-amount" style="min-width: 80px; font-weight: bold; color: var(--accent-green);">$0.00</span>
                                <button class="btn-danger btn-small" onclick="removeDebtor(0)" style="margin-left: 8px; display: none;">√ó</button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
                        <button class="btn-small" onclick="addDebtor()" style="background-color: var(--accent-blue);">+ Add Another Debtor</button>
                        <div>
                            <span id="totalPercentage" style="font-weight: bold; color: var(--text-primary);">Total: 0%</span>
                            <button class="btn-small" onclick="autoFillPercentages()" style="margin-left: 10px; background-color: var(--text-muted);">Equal Split</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn-small" onclick="addTransaction()" id="addTransactionBtn" disabled>Add Transaction(s)</button>
                    </div>

                    <p style="font-size: 13px; color: var(--text-muted); margin: 10px 0; text-align: center;">
                        üí° Tip: Add percentages to split payment among multiple people, or leave one person at 100%
                    </p>
                </div>

                <!-- Process and Export Buttons -->
                <div class="process-section" style="display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap;">
                    <button class="btn-success" id="processAllBtn" onclick="processAllTransactions()" disabled>
                        üöÄ Process All Transactions
                    </button>
                    <button class="btn-success" id="exportBtn" onclick="exportTransactionsCSV()" style="display: none; background-color: var(--accent-green);">
                        üìä Export CSV
                    </button>
                </div>
            </div>

            <!-- Right Side: Transactions List -->
            <div style="flex: 1; min-width: 400px;">
                <!-- Combined Transactions List -->
                <div class="transactions-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                        <h3 style="margin: 0;">All Transactions (<span id="transactionCount">0</span>)</h3>
                        <button class="btn-clear" id="clearAllBtn" onclick="clearAllTransactions()" style="display: none;">
                            üóëÔ∏è Clear All
                        </button>
                    </div>
                    <div id="transactionsList">
                        <div class="empty-state">No transactions added yet. Upload a CSV file or add transactions manually.</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="{{ url_for('static', filename='js/shared.js') }}"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>
</html>